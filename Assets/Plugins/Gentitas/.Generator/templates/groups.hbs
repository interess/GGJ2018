// <auto-generated>
//     This code was generated with love by Gentitas.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

using Entitas;
using System.Collections.Generic;

{{#each this}}
namespace {{@key}} {
	{{#each contexts}}
	public partial class {{toUpper @key}}Context {
		//
		// Single Groups
		//

		{{#each singleGroups}}
		// {{toUpper @key}} Group
		private IGroup<{{toUpper @../key}}Entity> _{{toLower @key}}Group;
		{{#if hasOneComponent}}
		public IGroup<{{toUpper @../key}}Entity> {{toLower @key}}Group {
			get { 
				if (_{{toLower @key}}Group == null) {
					_{{toLower @key}}Group = GetGroup({{#each matcher.all}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}});
				}
				return _{{toLower @key}}Group; } }
		{{else}}
		public IGroup<{{toUpper @../key}}Entity> {{toLower @key}}Group {
			get { 
				if (_{{toLower @key}}Group == null) {
					return GetGroup(Matcher<{{toUpper @../key}}Entity>{{#if matcher.all.length}}
								.AllOf({{#each matcher.all}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}}){{/if}}{{#if matcher.any.length}}
								.AnyOf({{#each matcher.any}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}}){{/if}}{{#if matcher.none.length}}
								.NoneOf({{#each matcher.none}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}}){{/if}});
				}
				return _{{toLower @key}}Group; } }
		{{/if}}

		public {{toUpper @../key}}Entity {{toLower @key}}Entity {
			get {
				var cachedGroup = {{toLower @key}}Group;
				if (cachedGroup.count > 1) {
					return null;
				}
				if (cachedGroup.count == 0) {
					return null;
				}
				return cachedGroup.GetSingleEntity(); } }

		{{#if hasOneComponent}}
		{{#if type}}
		public {{type}} {{toLower @key}} { 
			get {
				if ({{toLower @key}}Entity == null) throw new System.Exception("{{toUpper @../key}}Context has 0 or more than 1 entity with component '{{toUpper @key}}'. You can check safely with 'Has{{toUpper @key}}()'");
				return {{toLower @key}}Entity.{{toLower @key}};
			}	
			set { 
				if ({{toLower @key}}Group.count > 1) throw new System.Exception("{{toUpper @../key}}Context has more than 1 entity with component '{{toUpper @key}}'. You can check safely with 'Has{{toUpper @key}}()'");
				else if ({{toLower @key}}Group.count == 0) this.CreateEntity().{{toLower @key}} = value;
				else {{toLower @key}}Entity.{{toLower @key}} = value;
			}
		}
		{{else}}
		public bool {{toLower @key}} { 
			get { return {{toLower @key}}Group.count == 1; }	
			set {
				var cachedGroup = {{toLower @key}}Group;
				if (cachedGroup.count > 1) throw new System.Exception("{{toUpper @../key}}Context has more than 1 entity with component '{{toUpper @key}}'. You can check safely with 'Has{{toUpper @key}}()'");
				else if (cachedGroup.count == 0) {
					if (value) this.CreateEntity().{{toLower @key}} = value;
				}
				else {
					if (value) { {{toLower @key}}Entity.{{toLower @key}} = true; }
					else { {{toLower @key}}Entity.Destroy(); }
				}
			}
		}
		{{/if}}
		{{/if}}
		public bool Has{{toUpper @key}}() {	return {{toLower @key}}Group.count == 1;	}

		{{/each}}

		//
		// Groups
		//

		{{#each multiGroups}}
		// {{toUpper @key}} Group
		private IGroup<{{toUpper @../key}}Entity> _{{toLower @key}}Group;
		{{#if hasOneComponent}}
		public IGroup<{{toUpper @../key}}Entity> {{toLower @key}}Group {
			get { 
				if (_{{toLower @key}}Group == null) {
					_{{toLower @key}}Group = GetGroup({{#each matcher.all}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}});
				}
				return _{{toLower @key}}Group; } }
		{{else}}
		public IGroup<{{toUpper @../key}}Entity> {{toLower @key}}Group {
			get { 
				if (_{{toLower @key}}Group == null) {
					return GetGroup(Matcher<{{toUpper @../key}}Entity>{{#if matcher.all.length}}
								.AllOf({{#each matcher.all}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}}){{/if}}{{#if matcher.any.length}}
								.AnyOf({{#each matcher.any}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}}){{/if}}{{#if matcher.none.length}}
								.NoneOf({{#each matcher.none}}{{toUpper @../../key}}Matcher.{{toUpper this}}{{#unless @last}}, {{/unless}}{{/each}}){{/if}});
				}
				return _{{toLower @key}}Group; } }
		{{/if}}

		public {{toUpper @../key}}Entity[] {{toLower @key}}Entities { 
			get { return {{toLower @key}}Group.GetEntities(); } }
		
		{{/each}}
	}

	{{/each}}

}
{{/each}}
